# This file is an EasyBuild reciPY as per https://github.com/easybuilders/easybuild
# Updated: Denis Kristak
easyblock = 'CMakeMake'

name = 'lerc'
version = '3.0'

homepage = 'https://github.com/Esri/lerc'
description = """LERC is an open-source image or raster format which supports rapid encoding and decoding
for any pixel type (not just RGB or Byte). Users set the maximum compression error per pixel while encoding,
so the precision of the original input image is preserved (within user defined error bounds)."""

toolchain = {'name': 'foss', 'version': '2020b'}

source_urls = [
    'https://github.com/Esri/lerc/archive/',
    'https://raw.githubusercontent.com/Esri/lerc/33910e56d2d46e402b6233492eabb6c4fe0b3c5e/src/LercTest/',
]
local_testfile_sed_cmd = "sed -i -e 's|../LercLib/include/||' %(builddir)s/main.cpp"

sources = [
    'v%(version)s.tar.gz',
    {'filename': 'main.cpp', 'extract_cmd': 'cp %s %(builddir)s && ' + local_testfile_sed_cmd },
]
checksums = [
    '8c0148f5c22d823eff7b2c999b0781f8095e49a7d3195f13c68c5541dd5740a1',  # v3.0.tar.gz
    '0e3cc6d8a1d07ad209af9565a6c0736f1d8acb3b04c9c5d922307374352231b9',  # main.cpp
]

builddependencies = [
    ('CMake', '3.18.4'),
]

sanity_check_commands = [
    "cd %(builddir)s && g++ -o output_bin main.cpp -lLerc && ./output_bin "
]

sanity_check_paths = {
    'files': ['lib/libLerc.so'],
    'dirs': ['lib/', 'include/'],
}

moduleclass = 'tools'

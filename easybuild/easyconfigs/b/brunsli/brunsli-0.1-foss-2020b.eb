# This file is an EasyBuild reciPY as per https://github.com/easybuilders/easybuild
# Author: Denis Kristak
easyblock = 'CMakeMake'

name = 'brunsli'
version = '0.1'

homepage = 'https://github.com/google/brunsli/'
description = """LibLZF is a very small data compression library. It consists of only two .c and two .h files
and is very easy to incorporate into your own programs. The compression algorithm is very, very fast, yet still
written in portable C."""

toolchain = {'name': 'foss', 'version': '2020b'}

source_urls = ['https://github.com/google/brunsli/archive/']
sources = ['v%(version)s.tar.gz']
patches = ['patch_brunsli.patch']

builddependencies = [
    ('CMake', '3.18.4'),
    ('binutils', '2.35'),
]

dependencies = [
    ('Brotli', '1.0.9'),
    ('Highway', '0.12.2'),
]

configopts = ' -DCMAKE_BUILD_TYPE=Release '
configopts += ' -DCMAKE_CXX_FLAGS="$CXXFLAGS -lbrotlienc -lbrotlidec -lbrotlicommon "'

postinstallcmds = [
    'mkdir %(installdir)s/bin ',
    'cp dbrunsli %(installdir)s/bin ',
    'cp *.a %(installdir)s/lib64 ',
    'cp *.so %(installdir)s/lib64 ',
    ]

sanity_check_paths = {
    'files': [],
    'dirs': ['bin'],
}

moduleclass = 'lib'

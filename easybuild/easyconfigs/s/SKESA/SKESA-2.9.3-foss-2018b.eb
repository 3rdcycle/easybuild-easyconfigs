easyblock = 'MakeCp'

name = 'SKESA'
version = '2.9.3'

homepage = 'https://github.com/ncbi/ngs-tools/tree/master/tools/skesa'
description = "SKESA is a de-novo sequence read assembler for cultured single isolate genomes based on DeBruijn graphs."

toolchain = {'name': 'foss', 'version': '2018b'}
toolchainopts = {'cstd': 'c++11'}

source_urls = ['https://github.com/ncbi/ngs-tools/archive/']
sources = ['%(version)s.tar.gz']
patches = ['SKESA-2.9.1_fix-include.patch']
checksums = [
    '0395d4720e77f97585d870a54767b1280589c730a22486f7a6b1564f7e3ca970',  # 2.9.3.tar.gz
    '7817c1de31c0651070974ec4b20eea69f4686954acd3255586f311b39deaa64e',  # SKESA-2.9.1_fix-include.patch
]

builddependencies = [
    ('CMake', '3.12.1'),
    ('ant', '1.10.5', '-Java-%(javaver)s', True),
]
dependencies = [
    ('Java', '1.8', '', True),
    ('NGS', '2.9.3', '-Java-%(javaver)s'),
    ('ncbi-vdb', '2.9.3'),
    ('Boost', '1.67.0'),
]

start_dir = 'tools/skesa'

# Makefile.config must exist, but OK if it is empty
prebuildopts = "touch %(builddir)s/ngs-tools-%(version)s/build/Makefile.config && "

buildopts = 'skesa CC="$CXX" CFLAGS="$CXXFLAGS" '
buildopts += "NCBI_LIBPATH=$EBROOTNCBIMINVDB/lib64 NGS_LIBPATH=$EBROOTNGS/lib64 BOOST_LIBPATH=$EBROOTBOOST/lib"

files_to_copy = [(['skesa'], 'bin')]

sanity_check_paths = {
    'files': ['bin/skesa'],
    'dirs': [],
}

moduleclass = 'bio'

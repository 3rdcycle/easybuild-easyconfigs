easyblock = 'CMakeMakeCp'

name = 'openCARP'
version = '5.0-20210408'
local_commit = '6504fd72'

homepage = 'https://opencarp.org'
description = "openCARP is an open cardiac electrophysiology simulator for in-silico experiments."

toolchain = {'name': 'foss', 'version': '2020b'}
toolchainopts = {'openmp': True, 'usempi': True}

source_urls = ['https://git.opencarp.org/openCARP/openCARP/-/archive/%s/' % local_commit]
sources = [{'download_filename': 'openCARP-%s.tar.gz' % local_commit, 'filename': SOURCE_TAR_GZ}]
patches = ['openCARP-3.2_build-info.patch']
checksums = [
    '57b3c4953682688b6b58f2a6b927934dd3d592d0f4d07f4a709c39808a0d28ff',  # openCARP-5.0-20210408.tar.gz
    '43004c7dee2981677c4316c32ce20080ad2e70760d53981aaaaba55ebc659e8c',  # openCARP-3.2_build-info.patch
]

builddependencies = [
    ('CMake', '3.18.4'),
    ('gengetopt', '2.23'),
    ('pkg-config', '0.29.2'),
]

dependencies = [
    ('PETSc', '3.14.4'),
    ('zlib', '1.2.11'),
]

files_to_copy = ['bin']

sanity_check_paths = {
    'files': ['bin/%s' % x for x in ['bench', 'igbapd', 'igbextract', 'igbhead', 'igbops', 'mesher', 'openCARP']],
    'dirs': [],
}

moduleclass = 'bio'

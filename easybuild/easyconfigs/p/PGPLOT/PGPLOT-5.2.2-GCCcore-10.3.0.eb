# Contribution from Imperial College London (UK)
# Uploaded by J. Sassmannshausen

easyblock = 'CmdCp'

name = 'PGPLOT'
version = '5.2.2'

homepage = 'https://sites.astro.caltech.edu/~tjp/pgplot/'
description = """The PGPLOT Graphics Subroutine Library is a Fortran- or C-callable, 
device-independent graphics package for making simple scientific graphs. It is intended 
for making graphical images of publication quality with minimum effort on the part of 
the user. For most applications, the program can be device-independent, and the output 
can be directed to the appropriate device at run time."""

toolchain = {'name': 'GCCcore', 'version': '10.3.0'}

source_urls = ['ftp://ftp.astro.caltech.edu/pub/pgplot/']
sources = ['%%(namelower)s%s.tar.gz' % version.replace('.', '')]
patches = ['pgplot-compiler-pgplot522.patch']

checksums = [
    'a5799ff719a510d84d26df4ae7409ae61fe66477e3f1e8820422a9a4727a5be4',   # pgplot522.tar.gz
    'b1822eb32499dc18aa4aa4fae0b31c3c64ff8abb3a243716e78addafa7e58cec',   # pgplot-compiler-pgplot522.patch
]

builddependencies = [
    ('binutils', '2.36.1'),
]

dependencies = [
    ('libpng', '1.6.37'),
    ('zlib', '1.2.11'),
    ('X11', '20210518'),
]

cmds_map = [('.*', './makemake . linux g77_gcc && make && make shared && make cpg && make cpg-shared')]

files_to_copy = [
    (['pgdemo*'], 'bin'),
    (['libpgplot.*', 'libcpgplot.*'], 'lib'),
    (['grfont.dat'], 'share'),
    (['cpgplot.h'], 'include'),
]

postinstallcmds = [
    # create symlinks
    "cd %(installdir)s/lib && ln -s libcpgplot.so.5.2.2 libcpgplot.so.5 ; ln -s libcpgplot.so.5.2.2 libcpgplot.so && "
    " ln -s libpgplot.so.5.2.2 libpgplot.so.5 ; ln -s libpgplot.so.5.2.2 libpgplot.so"
]

sanity_check_paths = {
    'files': ['lib/libpgplot.a', 'lib/libcpgplot.a', 'lib/libpgplot.%s' % SHLIB_EXT, 'lib/libcpgplot.%s' % SHLIB_EXT],
    'dirs': []
}

modextravars = {'PGPLOT_FONT': '%(installdir)s/share/grfont.dat'}

moduleclass = 'vis'

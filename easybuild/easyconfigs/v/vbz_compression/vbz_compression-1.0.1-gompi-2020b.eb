easyblock = 'CMakeMake'

name = 'vbz_compression'
version = '1.0.1'

homepage = 'https://github.com/nanoporetech/vbz_compression'
description = "VBZ HDF5 plugin for nanopolish"

toolchain = {'name': 'gompi', 'version': '2020b'}

source_urls = [
    'https://github.com/nanoporetech/vbz_compression/archive',
    'https://github.com/lemire/streamvbyte/archive',
]
sources = [
    {'download_filename': 'v%(version)s.tar.gz', 'filename': SOURCE_TAR_GZ},
    {'download_filename': 'v0.4.1.tar.gz', 'filename': 'stramvbyte-v0.4.1.tar.gz'},
]

builddependencies = [('CMake', '3.18.4')]

dependencies = [
    ('HDF5', '1.10.7'),
    ('zstd', '1.4.5'),
]

preconfigopts = "rmdir %(builddir)s/vbz_compression*/third_party/streamvbyte && "
preconfigopts += "mv %(builddir)s/streamvbyte-* %(builddir)s/streamvbyte && "
preconfigopts += "mv %(builddir)s/streamvbyte %(builddir)s/vbz_compression*/third_party/. && "
configopts = "-DENABLE_CONAN=OFF -DENABLE_PERF_TESTING=OFF -DENABLE_PYTHON=OFF "

sanity_check_paths = {
    'files': ['hdf5/lib/plugin/libvbz_hdf_plugin.so'],
    'dirs': [],
}

modextrapaths = {'HDF5_PLUGIN_PATH': 'hdf5/lib/plugin/'}

moduleclass = 'lib'
